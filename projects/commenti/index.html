<!doctype html><html lang=ru>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Commenti - система встраиваемых комментариев.">
<title>Commenti</title>
<link rel=icon href=/favicon.ico sizes=any>
<link rel=icon href=/icon.svg type=image/svg+xml>
<link rel=stylesheet href=/sass/main.css>
<link rel=preconnect href=https://fonts.gstatic.com>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel=stylesheet>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SHLTY6NNFL"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-SHLTY6NNFL')</script>
</head>
<body>
<div class=page>
<div class=nav>
<div class=container>
<nav class="level is-mobile" role=navigation aria-label="main navigation">
<div class=level-left>
<ul class=menu>
<li>
<a href=/projects/>Проекты</a>
</li>
<li>
<a href=#contacts>
Контакты
</a>
</li>
</ul>
</div>
<div class=level-right>
</div>
</nav>
</div>
</div>
<main class=main>
<div class="container viewport-padding">
<div class="breadcrumb has-arrow-separator" aria-label=breadcrumbs>
<ul>
<li>
<a href=https://www.sprkweb.dev/>Вадим Сапрыкин</a>
</li>
<li>
<a href=https://www.sprkweb.dev/projects/>Проекты</a>
</li>
<li class=is-active>
<a href=https://www.sprkweb.dev/projects/commenti/ aria-current=page>Commenti</a>
</li>
</ul>
</div>
</div>
<div class="container viewport-padding">
<div class=hero>
<div class=hero-body>
<h1 class="title title-inline">Commenti</h1>
<h2 class=subtitle-inline>2021-...</h2>
<ul class="field is-grouped is-grouped-multiline">
<li class=control>
<a class="tag tag--svelte" href=https://www.sprkweb.dev/tags/svelte/>
<span class=icon-text>
<span class=icon>
<i class="fas fa-link"></i>
</span>
<span>Svelte</span>
</span>
</a>
</li>
<li class=control>
<a class="tag tag--typescript" href=https://www.sprkweb.dev/tags/typescript/>
<span class=icon-text>
<span class=icon>
<i class="fab fa-js-square"></i>
</span>
<span>TypeScript</span>
</span>
</a>
</li>
<li class=control>
<a class="tag tag--docker" href=https://www.sprkweb.dev/tags/docker/>
<span class=icon-text>
<span class=icon>
<i class="fab fa-docker"></i>
</span>
<span>Docker</span>
</span>
</a>
</li>
<li class=control>
<a class="tag tag--django" href=https://www.sprkweb.dev/tags/django/>
<span class=icon-text>
<span class=icon>
<i class="fab fa-dailymotion"></i>
</span>
<span>Django</span>
</span>
</a>
</li>
<li class=control>
<a class="tag tag--graphql" href=https://www.sprkweb.dev/tags/graphql/>
<span class=icon-text>
<span class=icon>
<i class="fas fa-dice-d20"></i>
</span>
<span>GraphQL</span>
</span>
</a>
</li>
<li class=control>
<a class="tag tag--postgresql" href=https://www.sprkweb.dev/tags/postgresql/>
<span class=icon-text>
<span class=icon>
<i class="fas fa-database"></i>
</span>
<span>PostgreSQL</span>
</span>
</a>
</li>
<li class=control>
<a class="tag tag--rollup" href=https://www.sprkweb.dev/tags/rollup/>
<span class=icon-text>
<span class=icon>
<i class="fas fa-scroll"></i>
</span>
<span>Rollup</span>
</span>
</a>
</li>
<li class=control>
<a class="tag tag--python" href=https://www.sprkweb.dev/tags/python/>
<span class=icon-text>
<span class=icon>
<i class="fab fa-python"></i>
</span>
<span>Python</span>
</span>
</a>
</li>
<li class=control>
<a class="tag tag--nginx" href=https://www.sprkweb.dev/tags/nginx/>
<span class=icon-text>
<span class=icon>
<i class="fas fa-server"></i>
</span>
<span>nginx</span>
</span>
</a>
</li>
<li class=control>
<a class="tag tag--javascript" href=https://www.sprkweb.dev/tags/javascript/>
<span class=icon-text>
<span class=icon>
<i class="fab fa-js-square"></i>
</span>
<span>JavaScript</span>
</span>
</a>
</li>
</ul>
</div>
</div>
</div>
<div class="content info-block links-block">
<div class="container viewport-padding">
<p>
<a href=https://github.com/sprkweb/commenti target=_blank rel=noreferrer><span class=icon-text>
<span class=icon>
<i class="fab fa-github-alt"></i>
</span>
<span>Посмотреть на GitHub</span>
</span>
</a>
</p>
</div>
</div>
<div class="content content-centered">
<p>Commenti - система встраиваемых комментариев.</p>
<figure class=full-width>
<a href=/projects/commenti/screenshot.png target=_blank>
<picture>
<source type=image/webp srcset=/projects/commenti/screenshot_hu8717b05326045ec070cd8f13ed8a7d5b_33266_896x3072_fit_q85_h2_lanczos_3.webp>
<img src=/projects/commenti/screenshot.png alt=Скриншот width=513 height=683>
</picture>
</a>
<figcaption>Скриншот</figcaption>
</figure>
<p><a href=https://github.com/sprkweb/commenti#readme target=_blank rel=noreferrer>Про особенности и установку</a></p>
<h2 id=стек-технологий>Стек технологий</h2>
<p>Одним из важнейших качеств для системы встраиваемых комментариев является лёгкость установки: для этого она и требуется, чтобы на существующий сайт с контентом быстро и без дополнительной разработки добавить возможность комментирования. В связи с этим, если не реализовывать бэкенд как SaaS (для чего нужны сервера → финансирование → коммерциализация), необходимо обеспечить легчайший способ установки на собственный сервер пользователями. Поэтому путём распространения были выбраны контейнеры, а именно Docker (с возможностью настройки переменными окружения), а для хранения данных - для возможности добавления в уже существующую инфраструктуру СУБД - PostgreSQL, потому что широко распространён (скорее всего, при желании, запустится и на MySQL, потому что SQL запросы генерирует Django).</p>
<p>Так как комментарии и ветвящиеся цепочки ответов на них представляют собой граф, а именно дерево, то очень хорошим выбором для их запроса и передачи представляется GraphQL. Представление и передача комментариев в виде дерева, где одни элементы вложены в другие, позволяет не только легче их преобразовывать в дерево визуальных компонентов, но и очень легко контролировать при запросе нужное число подуровней комментариев и максимальное число комментариев в каждом подуровне (в противоположность передаче в виде массива, который &ldquo;собирается&rdquo; в граф на стороне клиента с помощью ссылок на &ldquo;родителя&rdquo; у каждого комментария). Очень хорошо были заметны преимущества GraphQL конкретно в такой ситуации.</p>
<p>Так как Commenti - это всё-таки библиотека, выполняющая далеко не основную функцию на страницах, на которых она расположена, хотелось бы сделать её как можно меньшей по размеру и быстрой, а также обеспечить возможность использования с любым фреймворком или без него. Удобными и уместными в данной ситуации оказались Svelte с его &ldquo;компиляцией&rdquo; в относительно небольшой бесфреймворковый скрипт и Rollup с его tree-shaking. Впрочем, Rollup всё-таки очень тяжелый и медленный, а tree-shaking сейчас есть много где <em>[бросаю мимолётный взгляд на Snowpack + esbuild]</em>.</p>
</div>
<div class="container viewport-padding">
<div class="content postscript">
Дата последнего обновления страницы:
2022.01.25
</div>
</div>
</main>
<footer class=footer>
<div class=container>
<div class=columns>
<div class="column links-block contacts-list" id=contacts>
<h2>Контакты</h2>
<p><a href=https://t.me/saqew target=_blank rel=noreferrer><span class=icon-text>
<span class=icon>
<i title=Telegram class="fab fa-telegram"></i>
</span>
<span>@saqew</span>
</span>
</a></p>
<p><a href=mailto:sprkweb@ya.ru target=_blank rel=noreferrer><span class=icon-text>
<span class=icon>
<i title=Email class="fas fa-envelope"></i>
</span>
<span>sprkweb@ya.ru</span>
</span>
</a></p>
<p><a href=https://github.com/sprkweb target=_blank rel=noreferrer><span class=icon-text>
<span class=icon>
<i title=GitHub class="fab fa-github"></i>
</span>
<span>sprkweb</span>
</span>
</a></p>
<p><a href=https://www.linkedin.com/in/sprkweb/ target=_blank rel=noreferrer><span class=icon-text>
<span class=icon>
<i title=LinkedIn class="fab fa-linkedin-in"></i>
</span>
<span>sprkweb</span>
</span>
</a></p>
</div>
<script>const contactsEl=document.getElementById('contacts'),highlightAnimation=[{outline:'5px solid rgba(255, 255, 255, 0)'},{outline:'5px solid var(--brand-color)',offset:.5},{outline:'5px solid rgba(255, 255, 255, 0)'}];document.querySelectorAll('a[href="#contacts"]').forEach(a=>a.addEventListener('click',()=>contactsEl.animate(highlightAnimation,{duration:1e3,iterations:2,easing:'linear'})))</script>
<div class="column links-block">
<div class="plain-links block">
<p>
<a href=/projects/>Проекты</a>
</p>
</div>
<p class=block>
<a href=https://github.com/sprkweb/sprkweb.github.io target=_blank rel=noreferrer><span class=icon-text>
<span>Этот сайт на GitHub</span>
<span class=icon>
<i class="fab fa-github-alt"></i>
</span>
</span>
</a>
</p>
<p class=block>
<a href=https://creativecommons.org/licenses/by/4.0/ target=_blank rel=noreferrer title="Creative Commons Attribution 4.0 International" class=no-gap-inline><span class="icon is-small">
<i class="fab fa-creative-commons"></i>
</span>
<span class="icon is-small">
<i class="fab fa-creative-commons-by"></i>
</span>
</a>
</p>
</div>
</div>
</div>
</footer>
</div>
</body>
</html>