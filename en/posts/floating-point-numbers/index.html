<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="There are many features in programming languages that are prone to problems and should be used with caution. One of the most famous examples is the goto operator. Floating-point numbers should also be considered as such features."><title>Maybe what you need is not floating-point numbers</title>
<script>const curLang="en",availableLangs=["en","ru"],langLinks={en:"https://www.sprkweb.dev/en/posts/floating-point-numbers/",ru:"https://www.sprkweb.dev/posts/floating-point-numbers/"},preferredLang=window.navigator.language,userLang=localStorage.getItem("lang")||preferredLang,redirectToLang=e=>window.location.replace(langLinks[e]),setLang=e=>localStorage.setItem("lang",e);curLang!==userLang&&availableLangs.includes(userLang)&&redirectToLang(userLang)</script><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/icon.svg type=image/svg+xml><link rel=stylesheet href=/sass/main.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-SHLTY6NNFL"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SHLTY6NNFL")</script></head><body><div class=content-centered><nav class=nav role=navigation aria-label="main navigation"><ul class="row-list row-list-gapped"><li>Posts</li><li><a href=#contacts>Contacts</a></li></ul><div class=nav-right><ul class="lang-list row-list button"><li class=active>en</li><li><a href=https://www.sprkweb.dev/posts/floating-point-numbers/ onclick='setLang("ru")'>ru</a></li></ul></div></nav><main><ul class="breadcrumbs row-list" aria-label=breadcrumbs><li><a href=https://www.sprkweb.dev/en/>Vadim Saprykin</a></li><li><a href=https://www.sprkweb.dev/en/posts/>Posts</a></li><li><a href=https://www.sprkweb.dev/en/posts/floating-point-numbers/ aria-current=page>Maybe what you need is not floating-point numbers</a></li></ul><div class=content><h1>Maybe what you need is not floating-point numbers</h1><p>2023.02.26.
Tags:
<a href=https://www.sprkweb.dev/en/tags/golang/>Golang</a></p><p>There are many features in programming languages that are prone to problems and should be used with caution. One of the most famous examples is the goto operator. Floating-point numbers should also be considered as such features.</p><h2 id=why>Why?</h2><p>I will not enumerate all possible problems of floating point numbers: most likely, you are already familiar with many of them, and if not, I recommend to read the following articles:</p><ul><li><a href=https://jvns.ca/blog/2023/01/13/examples-of-floating-point-problems/ target=_blank rel=noreferrer>Examples of floating point problems</a></li><li><a href=https://orlp.net/blog/ordering-numbers/ target=_blank rel=noreferrer>Ordering Numbers, How Hard Can It Be?</a></li></ul><p>Such behavior creates an additional cognitive load on the developer and room for errors. How many programmers can, without thinking much, say the minimum step for changing a specific floating-point number?</p><p>Don&rsquo;t get me wrong: the message of the article is not that floating point numbers should not be used. They are a tool with its own use cases. This article is about <strong>when it is better to use other tools</strong>.</p><h2 id=so-what-do-we-do>So what do we do?</h2><p>If you want to use floating point numbers somewhere, you can consider the following possibilities instead:</p><h3 id=1-integers>1. Integers</h3><p>Identifiers, counters, ordinal numbers are the most obvious examples of values that are better represented as integers. But there are many other cases in which, if you think twice, integers turn out to be the best solution.</p><p>For example, if you want to store a fractional number of kilometers, then it may be worth presenting them not as kilometers, but as meters / centimeters / millimeters:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// ‚ùå it is not exactly 17.529 kilometers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>distanceKilometers</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>17.529</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// üëç that&#39;s better!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>distanceMeters</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>17529</span>
</span></span></code></pre></div><p>You can do the same with other physical quantities.</p><h3 id=2-decimal>2. Decimal</h3><p>In cases where the needed precision is not known beforehand, but it is very important that the representation in decimal format exactly matches the stored one (eg, for money amounts), you can use special libraries for decimal numbers.</p><p>In Python, for example, there is a module <code>decimal</code> in the standard library:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> my_salary <span style=color:#f92672>=</span> <span style=color:#ae81ff>10.1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> print(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{:.16f}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(my_salary))
</span></span><span style=display:flex><span><span style=color:#ae81ff>10.0999999999999996</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#f92672>from</span> decimal <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> my_salary <span style=color:#f92672>=</span> Decimal(<span style=color:#e6db74>&#39;10.1&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> print(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{:.16f}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(my_salary))
</span></span><span style=display:flex><span><span style=color:#ae81ff>10.1000000000000000</span>
</span></span></code></pre></div><h3 id=3-rational-numbers>3. Rational numbers</h3><p>Sometimes the numbers are divided by some known number, which may not be a multiple of ten:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fullPageWidth</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>blocksAmount</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>blockWidth</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fullPageWidth</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>blocksAmount</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>blockWidth</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>blocksAmount</span>) <span style=color:#f92672>!=</span> <span style=color:#a6e22e>fullPageWidth</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;We need a perfect fit!&#34;</span>) 
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Perfect!&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//=&gt; We need a perfect fit!
</span></span></span></code></pre></div><p>In such cases you can use rational numbers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;math/big&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fullPageWidth</span> <span style=color:#f92672>:=</span> new(<span style=color:#a6e22e>big</span>.<span style=color:#a6e22e>Rat</span>).<span style=color:#a6e22e>SetInt64</span>(<span style=color:#ae81ff>1000</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>blocksAmount</span> <span style=color:#f92672>:=</span> new(<span style=color:#a6e22e>big</span>.<span style=color:#a6e22e>Rat</span>).<span style=color:#a6e22e>SetInt64</span>(<span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>blockWidth</span> <span style=color:#f92672>:=</span> new(<span style=color:#a6e22e>big</span>.<span style=color:#a6e22e>Rat</span>).<span style=color:#a6e22e>Quo</span>(<span style=color:#a6e22e>fullPageWidth</span>, <span style=color:#a6e22e>blocksAmount</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> new(<span style=color:#a6e22e>big</span>.<span style=color:#a6e22e>Rat</span>).<span style=color:#a6e22e>Mul</span>(<span style=color:#a6e22e>blockWidth</span>, <span style=color:#a6e22e>blocksAmount</span>).<span style=color:#a6e22e>Cmp</span>(<span style=color:#a6e22e>fullPageWidth</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;We need a perfect fit!&#34;</span>)
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Perfect!&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//=&gt; Perfect!
</span></span></span></code></pre></div><h3 id=4-specialized-types>4. Specialized types</h3><p>Many databases and some languages already have predefined types for units such as time and money. It is worth learning about their availability and features: such types have already thought out the storage method and all the necessary operations.</p><h2 id=conclusion>Conclusion</h2><p>If you want to use fractional numbers, floating point numbers may not be what you need.</p><p>Floating point numbers should be used when precision is not important and approximate values are fine.</p><p>In other cases, you might use integers, decimals, rational numbers, and specialized types for values such as money and time instead.</p></div></main><footer class=footer><ul id=contacts class="row-list row-list-gapped"><li><a href=https://t.me/saqew class=icon-link target=_blank rel=noreferrer><span class=icon-text><span class=icon title=Telegram><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span><span class=icon-text-label>@saqew</span></span></a></li><li><a href=mailto:sprkweb@ya.ru class=icon-link target=_blank rel=noreferrer><span class=icon-text><span class=icon title=Email><svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><title>Mail</title><path d="M424 80H88a56.06 56.06.0 00-56 56v240a56.06 56.06.0 0056 56h336a56.06 56.06.0 0056-56V136a56.06 56.06.0 00-56-56zm-14.18 92.63-144 112a16 16 0 01-19.64.0l-144-112a16 16 0 1119.64-25.26L256 251.73l134.18-104.36a16 16 0 0119.64 25.26z"/></svg></span><span class=icon-text-label>sprkweb@ya.ru</span></span></a></li><li><a href=https://github.com/sprkweb class=icon-link target=_blank rel=noreferrer><span class=icon-text><span class=icon title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><title>Logo Github</title><path d="M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.56 17.56.0 003.8.4c8.3.0 11.5-6.1 11.5-11.4.0-5.5-.2-19.9-.3-39.1a102.4 102.4.0 01-22.6 2.7c-43.1.0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0025.6-6c2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8a18.64 18.64.0 015-.5c8.1.0 26.4 3.1 56.6 24.1a208.21 208.21.0 01112.2.0c30.2-21 48.5-24.1 56.6-24.1a18.64 18.64.0 015 .5c12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5a19.35 19.35.0 004-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"/></svg></span><span class=icon-text-label>sprkweb</span></span></a></li><li><a href=https://www.linkedin.com/in/sprkweb/ class=icon-link target=_blank rel=noreferrer><span class=icon-text><span class=icon title=LinkedIn><svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><title>Logo Linkedin</title><path d="M444.17 32H70.28C49.85 32 32 46.7 32 66.89v374.72C32 461.91 49.85 480 70.28 480h373.78c20.54.0 35.94-18.21 35.94-38.39V66.89C480.12 46.7 464.6 32 444.17 32zm-273.3 373.43h-64.18V205.88h64.18zM141 175.54h-.46c-20.54.0-33.84-15.29-33.84-34.43.0-19.49 13.65-34.42 34.65-34.42s33.85 14.82 34.31 34.42c-.01 19.14-13.31 34.43-34.66 34.43zm264.43 229.89h-64.18V296.32c0-26.14-9.34-44-32.56-44-17.74.0-28.24 12-32.91 23.69-1.75 4.2-2.22 9.92-2.22 15.76v113.66h-64.18V205.88h64.18v27.77c9.34-13.3 23.93-32.44 57.88-32.44 42.13.0 74 27.77 74 87.64z"/></svg></span><span class=icon-text-label>sprkweb</span></span></a></li></ul><script>const contactsEl=document.getElementById("contacts"),highlightAnimation=[{outline:"5px solid rgba(255, 255, 255, 0)"},{outline:"5px solid var(--outline-color)",offset:.5},{outline:"5px solid rgba(255, 255, 255, 0)"}];document.querySelectorAll('a[href="#contacts"]').forEach(e=>e.addEventListener("click",()=>contactsEl.animate(highlightAnimation,{duration:1e3,iterations:2,easing:"linear"})))</script><p><a href=https://github.com/sprkweb/sprkweb.github.io class=icon-link target=_blank rel=noreferrer><span class=icon-text><span class=icon-text-label>This site on GitHub</span>
<span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87.0 00-40.81.0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34.0 01-48.55.0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86.0 000 40.81l195.61 195.6a28.86 28.86.0 0040.8.0l194.69-194.69a28.86 28.86.0 000-40.81z"/></svg></span></span></a></p><p><a href=https://creativecommons.org/licenses/by/4.0/ target=_blank rel=noreferrer title="Creative Commons Attribution 4.0 International"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93-22.13.0-33.22 14.61-33.22 43.84.0 23.57 9.21 43.84 33.22 43.84 14.47.0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98-22.6.0-73.96-10.32-73.96-77.05.0-58.69 43-77.06 72.63-77.06 30.72-.01 52.7 11.95 65.99 35.86zm143.05.0-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93-22.14.0-33.22 14.61-33.22 43.84.0 23.55 9.23 43.84 33.22 43.84 14.45.0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98-22.69.0-73.96-9.87-73.96-77.05.0-58.67 42.97-77.06 72.63-77.06 30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05.0 123.11.0 256.05c0 138.49 113.6 248 247.56 248 129.93.0 248.44-100.87 248.44-248 0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54.0-203.7-93.04-203.7-202.81.0-105.42 85.43-203.27 203.72-203.27 112.53.0 202.82 89.46 202.82 203.26-.01 121.69-99.68 202.82-202.84 202.82z"/></svg></span><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3 3.1-3.1 6.9-4.7 11.3-4.7H299c4.1.0 7.8 1.6 11.1 4.7 3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5.0 256 0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8 103.2.0 202.8-81.1 202.8-202.8.1-113.8-90.2-203.3-202.8-203.3z"/></svg></span></a></p></footer></div></body></html>