<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Recently in one of my pet projects I added Go code compiled in WebAssembly (WASM) for client-side execution. The interface is made with Svelte with TypeScript, and the logic is implemented in Golang. As a result, I got an interesting experience that I want to share: how to make Go, WebAssembly and TypeScript work together."><title>How to make Go, WebAssembly and TypeScript work together</title>
<script>const curLang="en",availableLangs=["en","ru"],langLinks={en:"https://www.sprkweb.dev/en/posts/go-wasm-with-typescript/",ru:"https://www.sprkweb.dev/posts/go-wasm-with-typescript/"},preferredLang=window.navigator.language,userLang=localStorage.getItem("lang")||preferredLang,redirectToLang=e=>window.location.replace(langLinks[e]),setLang=e=>localStorage.setItem("lang",e);curLang!==userLang&&availableLangs.includes(userLang)&&redirectToLang(userLang)</script><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/icon.svg type=image/svg+xml><link rel=stylesheet href=/sass/main.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-SHLTY6NNFL"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SHLTY6NNFL")</script></head><body><div class=content-centered><nav class=nav role=navigation aria-label="main navigation"><ul class="row-list row-list-gapped"><li>Posts</li><li><a href=#contacts>Contacts</a></li></ul><div class=nav-right><ul class="lang-list row-list button"><li class=active>en</li><li><a href=https://www.sprkweb.dev/posts/go-wasm-with-typescript/ onclick='setLang("ru")'>ru</a></li></ul></div></nav><main><ul class="breadcrumbs row-list" aria-label=breadcrumbs><li><a href=https://www.sprkweb.dev/en/>Vadim Saprykin</a></li><li><a href=https://www.sprkweb.dev/en/posts/>Posts</a></li><li><a href=https://www.sprkweb.dev/en/posts/go-wasm-with-typescript/ aria-current=page>How to make Go, WebAssembly and TypeScript work together</a></li></ul><div class=content><h1>How to make Go, WebAssembly and TypeScript work together</h1><p>2023.11.29.
Tags:
<a href=https://www.sprkweb.dev/en/tags/golang/>Golang</a>, <a href=https://www.sprkweb.dev/en/tags/development-history/>Development History</a>, <a href=https://www.sprkweb.dev/en/tags/case/>Case</a></p><p>Recently in one <a href=https://github.com/sprkweb/finaplan-web/tree/fab272594212a8c390a57f4ff5aede30489c9f05 target=_blank rel=noreferrer>of my pet projects</a> I added Go code compiled in WebAssembly (<em>WASM</em>) for client-side execution. The interface is made with Svelte with TypeScript, and the logic is implemented in Golang. As a result, I got an interesting experience that I want to share: how to make Go, WebAssembly and TypeScript work together.</p><h2>Table of contents</h2><nav id=TableOfContents><ol><li><a href=#how-to-export-go-function-to-javascript>How to export Go function to JavaScript</a></li><li><a href=#compiling-go-code-into-webassembly>Compiling Go code into WebAssembly</a></li><li><a href=#running-go-code-in-javascript>Running Go code in JavaScript</a></li><li><a href=#how-to-create-a-javascript-class-via-webassembly>How to create a JavaScript class via WebAssembly</a></li><li><a href=#error-handling>Error handling</a></li><li><a href=#create-types-for-typescript>Create types for TypeScript</a></li><li><a href=#all-together>All together</a></li></ol></nav><h2 id=how-to-export-go-function-to-javascript>How to export Go function to JavaScript</h2><p>Create a separate directory for Go module with <code>go.mod</code> and <code>main.go</code> files.</p><p>You cannot directly import functions from Go into JavaScript. Instead, your Go code running in a browser can create global functions or any other global variables for JavaScript.</p><p>You can register a global function for JavaScript like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;syscall/js&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>myFunc</span>(<span style=color:#a6e22e>this</span> <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>Value</span>, <span style=color:#a6e22e>args</span> []<span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>Value</span>) <span style=color:#a6e22e>any</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;hello&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// create a global variable MyFunc in JavaScript 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// and assign a function to it
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>Global</span>().<span style=color:#a6e22e>Set</span>(<span style=color:#e6db74>&#34;MyFunc&#34;</span>, <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>FuncOf</span>(<span style=color:#a6e22e>myFunc</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// wait indefinitely so that Go does not terminate execution 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// and the function remains available
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#f92672>&lt;-</span>make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{}) 
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><a href=https://pkg.go.dev/syscall/js target=_blank rel=noreferrer><code>syscall/js</code></a> is a package from the Go standard library. The Go compiler and your IDE may complain that they don&rsquo;t know it. To avoid this, you should add a directive to the beginning of <code>main.go</code> that the file can be compiled only to WebAssembly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>//go:build wasm
</span></span></span><span style=display:flex><span><span style=color:#75715e>// +build wasm
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;syscall/js&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span></code></pre></div><h2 id=compiling-go-code-into-webassembly>Compiling Go code into WebAssembly</h2><p>Compile with environment variables <code>GOOS=js</code> and <code>GOARCH=wasm</code>. You can make a <code>Makefile</code> for convenience:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Makefile data-lang=Makefile><span style=display:flex><span><span style=color:#a6e22e>build</span><span style=color:#f92672>:</span> copy-wasm-exec
</span></span><span style=display:flex><span>	GOOS<span style=color:#f92672>=</span>js GOARCH<span style=color:#f92672>=</span>wasm go build -o main.wasm
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>copy-wasm-exec</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>	cp <span style=color:#66d9ef>$(</span>shell go env GOROOT<span style=color:#66d9ef>)</span>/misc/wasm/wasm_exec.js .
</span></span></code></pre></div><p>The <code>make build</code> command does the compilation. The <code>make copy-wasm-exec</code> command copies the <code>wasm_exec.js</code> library from your version of Go. We&rsquo;ll need this library when running WebAssembly from JavaScript.</p><h2 id=running-go-code-in-javascript>Running Go code in JavaScript</h2><p>In order to execute Go code compiled into WebAssembly, you need to import <code>wasm_exec.js</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// $go is an alias for path to our Go module
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#39;$go/wasm_exec&#39;</span> 
</span></span></code></pre></div><p>This file creates the <code>Go</code> class. Its TypeScript type:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>declare</span> <span style=color:#66d9ef>global</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Window</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Go</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> ()<span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>run</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>inst</span>: <span style=color:#66d9ef>WebAssembly.Instance</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>void</span>&gt;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>importObject</span>: <span style=color:#66d9ef>WebAssembly.Imports</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Running the WebAssembly binary in the browser is done using the <a href=https://developer.mozilla.org/en-US/docs/WebAssembly/Loading_and_running target=_blank rel=noreferrer><code>WebAssembly.instantiateStreaming</code></a>, <code>fetch</code> and the imported <code>Go</code> class:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// `wasm` variable contains URL
</span></span></span><span style=display:flex><span><span style=color:#75715e>// of our WASM binary
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>wasm</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;$go/main.wasm?url&#39;</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// load and run our Go code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>load() {</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>WebAssembly</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;WebAssembly is not supported in your browser&#39;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>go</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> window.<span style=color:#a6e22e>Go</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>WebAssembly</span>.<span style=color:#a6e22e>instantiateStreaming</span>(
</span></span><span style=display:flex><span>		<span style=color:#75715e>// load the binary
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>wasm</span>), 
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>go</span>.<span style=color:#a6e22e>importObject</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// run it
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>go</span>.<span style=color:#a6e22e>run</span>(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>instance</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// wait until it creates the function we need
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>until</span>(() <span style=color:#f92672>=&gt;</span> window.<span style=color:#a6e22e>MyFunc</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>undefined</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// return the function
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> window.<span style=color:#a6e22e>MyFunc</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// helper Promise which waits until `f` is true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>until</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>boolean</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>void</span>&gt; <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Promise</span>(<span style=color:#a6e22e>resolve</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>intervalCode</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>setInterval</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>f</span>()) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>resolve</span>()
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>clearInterval</span>(<span style=color:#a6e22e>intervalCode</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }, <span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=how-to-create-a-javascript-class-via-webassembly>How to create a JavaScript class via WebAssembly</h2><p>In JavaScript, a class is a function that creates an object. In order to create such a class from Go, we need to create functions for its constructor and methods. In each function we need to convert the types: at the beginning we convert <code>js.Value</code> to the type we need and vice versa at the end.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>wrapper</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>obj</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>mypkg</span>.<span style=color:#a6e22e>myObj</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Constructor of a JavaScript object
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewObj</span>(<span style=color:#a6e22e>this</span> <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>Value</span>, <span style=color:#a6e22e>args</span> []<span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>Value</span>) <span style=color:#a6e22e>any</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Convert `js.Value` arguments to the types we need
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>name</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>String</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>number</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>Int</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Create an object
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>wrap</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>wrapper</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>obj</span>: <span style=color:#a6e22e>mypkg</span>.<span style=color:#a6e22e>NewObj</span>(<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>number</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Convert our wrapper to
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// JavaScript object with two methods
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>ValueOf</span>(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#a6e22e>any</span>{
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;set&#34;</span>: <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>FuncOf</span>(<span style=color:#a6e22e>wrap</span>.<span style=color:#a6e22e>Set</span>),
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;get&#34;</span>: <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>FuncOf</span>(<span style=color:#a6e22e>wrap</span>.<span style=color:#a6e22e>Get</span>),
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The object&#39;s method
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>w</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>wrapper</span>) <span style=color:#a6e22e>Set</span>(<span style=color:#a6e22e>this</span> <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>Value</span>, <span style=color:#a6e22e>args</span> []<span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>Value</span>) <span style=color:#a6e22e>any</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>name</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>String</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>number</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>Int</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>obj</span>.<span style=color:#a6e22e>Set</span>(<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>number</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>ValueOf</span>(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#a6e22e>any</span>{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;error&#34;</span>:  <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>(),
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>ValueOf</span>(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#a6e22e>any</span>{
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;result&#34;</span>: <span style=color:#a6e22e>res</span>,
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span></code></pre></div><h2 id=error-handling>Error handling</h2><p>In Go code, you <em>can&rsquo;t</em> throw a JavaScript exception. If you throw a panic in Go code, it will terminate and you will no longer be able to call its functions.</p><p>If your function can fail, you can return an object that contains either a <code>result</code> or <code>error</code> field. In TypeScript notation, the interface looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Result</span>&lt;<span style=color:#f92672>T</span>&gt;{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result?</span>: <span style=color:#66d9ef>T</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error?</span>: <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then error checking can be like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>error</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>myobj</span>.<span style=color:#66d9ef>get</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>error</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// handle error
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// handle result
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><h2 id=create-types-for-typescript>Create types for TypeScript</h2><p>You should create TypeScript types for everything imported from Go:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>declare</span> <span style=color:#66d9ef>global</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Window</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>NewObj</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>num</span>: <span style=color:#66d9ef>number</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>MyObj</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>MyObj</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>get</span>() <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Result</span>&lt;<span style=color:#f92672>number</span>&gt;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>set</span>(<span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>num</span>: <span style=color:#66d9ef>number</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Result</span>&lt;<span style=color:#f92672>number</span>&gt;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=all-together>All together</h2><p>You can see an example of how it all fits together on GitHub:</p><ul><li><a href=https://github.com/sprkweb/finaplan-web/tree/fab272594212a8c390a57f4ff5aede30489c9f05/src/lib/go target=_blank rel=noreferrer>Go module compiled to WebAssembly</a></li><li><a href=https://github.com/sprkweb/finaplan-web/blob/fab272594212a8c390a57f4ff5aede30489c9f05/src/routes/finaplan.ts target=_blank rel=noreferrer>Running a WebAssembly binary and declaring TypeScript types</a></li></ul></div></main><footer class=footer><ul id=contacts class="row-list row-list-gapped"><li><a href=https://t.me/saqew class=icon-link target=_blank rel=noreferrer><span class=icon-text><span class=icon title=Telegram><svg viewBox="0 0 496 512"><path d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg>
</span><span class=icon-text-label>@saqew</span></span></a></li><li><a href=mailto:sprkweb@ya.ru class=icon-link target=_blank rel=noreferrer><span class=icon-text><span class=icon title=Email><svg class="ionicon" viewBox="0 0 512 512"><title>Mail</title><path d="M424 80H88a56.06 56.06.0 00-56 56v240a56.06 56.06.0 0056 56h336a56.06 56.06.0 0056-56V136a56.06 56.06.0 00-56-56zm-14.18 92.63-144 112a16 16 0 01-19.64.0l-144-112a16 16 0 1119.64-25.26L256 251.73l134.18-104.36a16 16 0 0119.64 25.26z"/></svg>
</span><span class=icon-text-label>sprkweb@ya.ru</span></span></a></li><li><a href=https://github.com/sprkweb class=icon-link target=_blank rel=noreferrer><span class=icon-text><span class=icon title=GitHub><svg class="ionicon" viewBox="0 0 512 512"><title>Logo Github</title><path d="M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.56 17.56.0 003.8.4c8.3.0 11.5-6.1 11.5-11.4.0-5.5-.2-19.9-.3-39.1a102.4 102.4.0 01-22.6 2.7c-43.1.0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0025.6-6c2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8a18.64 18.64.0 015-.5c8.1.0 26.4 3.1 56.6 24.1a208.21 208.21.0 01112.2.0c30.2-21 48.5-24.1 56.6-24.1a18.64 18.64.0 015 .5c12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5a19.35 19.35.0 004-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"/></svg>
</span><span class=icon-text-label>sprkweb</span></span></a></li><li><a href=https://www.linkedin.com/in/sprkweb/ class=icon-link target=_blank rel=noreferrer><span class=icon-text><span class=icon title=LinkedIn><svg class="ionicon" viewBox="0 0 512 512"><title>Logo Linkedin</title><path d="M444.17 32H70.28C49.85 32 32 46.7 32 66.89v374.72C32 461.91 49.85 480 70.28 480h373.78c20.54.0 35.94-18.21 35.94-38.39V66.89C480.12 46.7 464.6 32 444.17 32zm-273.3 373.43h-64.18V205.88h64.18zM141 175.54h-.46c-20.54.0-33.84-15.29-33.84-34.43.0-19.49 13.65-34.42 34.65-34.42s33.85 14.82 34.31 34.42c-.01 19.14-13.31 34.43-34.66 34.43zm264.43 229.89h-64.18V296.32c0-26.14-9.34-44-32.56-44-17.74.0-28.24 12-32.91 23.69-1.75 4.2-2.22 9.92-2.22 15.76v113.66h-64.18V205.88h64.18v27.77c9.34-13.3 23.93-32.44 57.88-32.44 42.13.0 74 27.77 74 87.64z"/></svg>
</span><span class=icon-text-label>sprkweb</span></span></a></li></ul><script>const contactsEl=document.getElementById("contacts"),highlightAnimation=[{outline:"5px solid rgba(255, 255, 255, 0)"},{outline:"5px solid var(--outline-color)",offset:.5},{outline:"5px solid rgba(255, 255, 255, 0)"}];document.querySelectorAll('a[href="#contacts"]').forEach(e=>e.addEventListener("click",()=>contactsEl.animate(highlightAnimation,{duration:1e3,iterations:2,easing:"linear"})))</script><p><a href=https://github.com/sprkweb/sprkweb.github.io class=icon-link target=_blank rel=noreferrer><span class=icon-text><span class=icon-text-label>This site on GitHub</span>
<span class=icon><svg viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87.0 00-40.81.0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34.0 01-48.55.0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86.0 000 40.81l195.61 195.6a28.86 28.86.0 0040.8.0l194.69-194.69a28.86 28.86.0 000-40.81z"/></svg></span></span></a></p><p><a href=https://creativecommons.org/licenses/by/4.0/ target=_blank rel=noreferrer title="Creative Commons Attribution 4.0 International"><span class=icon><svg viewBox="0 0 496 512"><path d="M245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93-22.13.0-33.22 14.61-33.22 43.84.0 23.57 9.21 43.84 33.22 43.84 14.47.0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98-22.6.0-73.96-10.32-73.96-77.05.0-58.69 43-77.06 72.63-77.06 30.72-.01 52.7 11.95 65.99 35.86zm143.05.0-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93-22.14.0-33.22 14.61-33.22 43.84.0 23.55 9.23 43.84 33.22 43.84 14.45.0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98-22.69.0-73.96-9.87-73.96-77.05.0-58.67 42.97-77.06 72.63-77.06 30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05.0 123.11.0 256.05c0 138.49 113.6 248 247.56 248 129.93.0 248.44-100.87 248.44-248 0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54.0-203.7-93.04-203.7-202.81.0-105.42 85.43-203.27 203.72-203.27 112.53.0 202.82 89.46 202.82 203.26-.01 121.69-99.68 202.82-202.84 202.82z"/></svg>
</span><span class=icon><svg viewBox="0 0 496 512"><path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3 3.1-3.1 6.9-4.7 11.3-4.7H299c4.1.0 7.8 1.6 11.1 4.7 3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5.0 256 0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8 103.2.0 202.8-81.1 202.8-202.8.1-113.8-90.2-203.3-202.8-203.3z"/></svg></span></a></p></footer></div></body></html>