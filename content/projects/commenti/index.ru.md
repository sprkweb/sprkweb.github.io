---
title: "Commenti"
years: "2021-..."
gh_repo: "https://github.com/sprkweb/commenti"
tags: [Svelte, TypeScript, JavaScript, GraphQL, Rollup, Docker, Django, Python, PostgreSQL, nginx]
---

Commenti - система встраиваемых комментариев.
<!--more-->

{{< img "screenshot.png" "Скриншот" >}}

[Про особенности и установку](https://github.com/sprkweb/commenti#readme)

## Стек технологий

Одним из важнейших качеств для системы встраиваемых комментариев является лёгкость установки: для этого она и требуется, чтобы на существующий сайт с контентом быстро и без дополнительной разработки добавить возможность комментирования. В связи с этим, если не реализовывать бэкенд как SaaS (для чего нужны сервера → финансирование → коммерциализация), необходимо обеспечить легчайший способ установки на собственный сервер пользователями. Поэтому путём распространения были выбраны контейнеры, а именно Docker (с возможностью настройки переменными окружения), а для хранения данных - для возможности добавления в уже существующую инфраструктуру СУБД - PostgreSQL, потому что широко распространён (скорее всего, при желании, запустится и на MySQL, потому что SQL запросы генерирует Django).

Так как комментарии и ветвящиеся цепочки ответов на них представляют собой граф, а именно дерево, то очень хорошим выбором для их запроса и передачи представляется GraphQL. Представление и передача комментариев в виде дерева, где одни элементы вложены в другие, позволяет не только легче их преобразовывать в дерево визуальных компонентов, но и очень легко контролировать при запросе нужное число подуровней комментариев и максимальное число комментариев в каждом подуровне (в противоположность передаче в виде массива, который "собирается" в граф на стороне клиента с помощью ссылок на "родителя" у каждого комментария). Очень хорошо были заметны преимущества GraphQL конкретно в такой ситуации.

Так как Commenti - это всё-таки библиотека, выполняющая далеко не основную функцию на страницах, на которых она расположена, хотелось бы сделать её как можно меньшей по размеру и быстрой, а также обеспечить возможность использования с любым фреймворком или без него. Удобными и уместными в данной ситуации оказались Svelte с его "компиляцией" в относительно небольшой бесфреймворковый скрипт и Rollup с его tree-shaking. Впрочем, Rollup всё-таки очень тяжелый и медленный, а tree-shaking сейчас есть много где _[бросаю мимолётный взгляд на Snowpack + esbuild]_.
